<!DOCTYPE html>
<html  dir="ltr" lang="en" data-theme=""><head>
    <title> z64me | TP Link 64 Deluxe source now available </title>

    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.84.0" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description" content="Hoot hoot! ðŸ¦‰">
    
    
    
    <link rel="stylesheet"
        href="/css/main.min.a64b503bd01d7d777f851f0e4b751dcd433d000a2187b9494c48797538337163.css"
        integrity="sha256-pktQO9AdfXd/hR8OS3UdzUM9AAohh7lJTEh5dTgzcWM="
        crossorigin="anonymous"
        type="text/css">
    
    
    <link rel="stylesheet"
        href="/css/markupHighlight.min.bc108ac4d429f5e06afa75cfccb6585578f5198a03d669c1bd24b26e4a2895b7.css"
        integrity="sha256-vBCKxNQp9eBq&#43;nXPzLZYVXj1GYoD1mnBvSSybkoolbc="
        crossorigin="anonymous"
        type="text/css">
    
    <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" 
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" 
    crossorigin="anonymous" />
    
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

    <link rel="canonical" href="/post/tp-link-64-deluxe-source/">

    
    
    
    
    <script type="text/javascript"
            src="/js/anatole-header.min.98b79432dfa53ecc682fb19247f797a316f8cbca9d5455c8bb22e58fc694b675.js"
            integrity="sha256-mLeUMt&#43;lPsxoL7GSR/eXoxb4y8qdVFXIuyLlj8aUtnU="
            crossorigin="anonymous"></script>


    
        
        
        <script type="text/javascript"
                src="/js/anatole-theme-switcher.min.7fd87181cdd7e8413aa64b6867bb32f3a8dc242e684fc7d5bbb9f600dbc2b6eb.js"
                integrity="sha256-f9hxgc3X6EE6pktoZ7sy86jcJC5oT8fVu7n2ANvCtus="
                crossorigin="anonymous"></script>
    
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://z64.me/images/site-feature-image.png"/>

<meta name="twitter:title" content="TP Link 64 Deluxe source now available"/>
<meta name="twitter:description" content=""/>


    

</head>
<body>
<header><div class="page-top  . ">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <nav>
        <ul class="nav__list" id="navMenu">
            <div class="nav__links">
                
                
                    
                    <li><a 
                        href="/"
                                
                        title="">Home</a></li>
                
                    
                    <li><a 
                        href="/post/"
                                
                        title="">Posts</a></li>
                
                    
                    <li><a 
                        href="/about/"
                                
                        title="">About</a></li>
                
                
                    
                        <li><a href="/"
                            title=""></a>
                        </li>
                    
                        <li><a href="/ar/"
                            title=""></a>
                        </li>
                    
                
            </div>
            <li>
                
                <a class="theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
                
            </li>
        </ul>
    </nav>
</div>
</header>
<div class="wrapper">
    <aside><div class="sidebar . ">
    <div class="sidebar__content">
        <div class="logo-title">
            <div class="title">
                <img src="/images/profile.jpg" alt="profile picture">
                <h3 title=""><a href="/">z64me</a></h3>
                <div class="description">
                    <p>Hoot hoot! ðŸ¦‰</p>
                </div>
            </div>
        </div>
        <ul class="social-links">
            
                <li>
                    <a href="https://github.com/z64me" rel="me" aria-label="GitHub">
                        <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                    </a>
                </li>
            
                <li>
                    <a href="https://www.youtube.com/c/z64me/videos" rel="me" aria-label="YouTube">
                        <i class="fab fa-youtube fa-2x" aria-hidden="true"></i>
                    </a>
                </li>
            
        </ul>
    </div><footer class="footer footer--sidebar">        
    <div class="by_farbox">
        <ul class="footer__list">
            <li class="footer__item">&copy;
                
                    2018 - 2021
                
            </li>
            
            <li class="footer__item">
                <a href="https://old.z64.me/"  target="_blank" rel="noopener noreferrer"  title="">
                    old site
                </a>
            </li>
            
            <li class="footer__item">
                <a href="/post/index.xml"  title="">
                    rss
                </a>
            </li>
            
        </ul>
    </div>
</footer>

<script type="text/javascript"
        src="/js/medium-zoom.min.83cb1dd5fea8d42d87d1e601a07faa73089ad0ef9ccfe5daf6041289ebcc4e46.js"
        integrity="sha256-g8sd1f6o1C2H0eYBoH&#43;qcwia0O&#43;cz&#43;Xa9gQSievMTkY="
        crossorigin="anonymous"></script></div>
</aside>
    <main>
        <div class="autopagerize_page_element">
            <div class="content">
    <div class="post  . ">
        <div class="post-content">
            
            <img class="post-thumbnail" src="/thumbnails/tp-link-64-deluxe-source.png" alt="Thumbnail image">
            
            <div class="post-title">
                <h1>TP Link 64 Deluxe source now available</h1>
                
                    <div class="info">
                        <em class="fas fa-calendar-day"></em>
                        <span class="date"> 
                                                5/7/2021
                                           </span>
                        <em class="fas fa-stopwatch"></em>
                        <span class="reading-time">5-minute read</span>
                    </div>
                
            </div>

            <p>The <a href="https://www.youtube.com/watch?v=HG5e8ky8Q6Y">TP Link 64 Deluxe mod</a> was a collaboration with <a href="https://www.youtube.com/channel/UCAUDpAKuusmRmBO9Nle4FYA">Skilar</a>: his models, my code. The goal of this write-up is to briefly touch on the key points so you can apply these principles to your own projects.</p>
<h2 id="for-the-impatient">For the impatient</h2>
<p>Maybe you just want the code and assets. You can find them <a href="https://github.com/z64me/z64playerRenderInit/tree/master/example/tpLink">here</a>.</p>
<h2 id="intro">Intro</h2>
<p><code>zzconvert</code> has seen a lot of use over the years. It even has a cult following of sorts. It was lacking features, however, and the code was too spaghetti-like to maintain. I had big plans for <code>z64convert</code>, its successor, which is a complete rewrite.</p>
<p>When I build new software, I try to teach users by example. While tests involving colorful cubes are fun, the best example is a real-world use case, one that shows (rather than tells) users what they can do with it.</p>
<p>I decided each feature needs illustrated in an exciting way, and what&rsquo;s a more wowing demonstration of proxy pointers than fitting three entirely new outfits into a file that normally only contains one?</p>
<h2 id="what-is-a-proxy-pointer">What is a proxy pointer?</h2>
<p>As per tradition, I have created new terminology <del>to confuse everyone</del>.</p>
<p>A <strong>proxy pointer</strong> is a lame wrapper for a display list. This wrapper is accessed instead of the display list itself. Then, all would-be pointers to the display list are instead pointers to a pointer to the display list. This way, all references to it can easily be redirected to any model we wish by updating one pointer. That&rsquo;s a mouthful, so I settled on the term &ldquo;proxy pointer&rdquo;, which succinctly describes what is going on and is an easy concept to grasp.</p>
<h2 id="reusing-pieces">Reusing pieces</h2>
<p>Link&rsquo;s original model file is a mere 227.3 kB, and there is a lot of extra content going in it, so it&rsquo;s a good idea to reuse pieces when possible.
<figure class="small"><img src="/images/tp-link-64-deluxe-source-1.png"
         alt="image"/><figcaption>
            <p>All reusable pieces have been moved into their own rigged mesh. Dummy triangles are used to keep limb indices consistent. A high <code>priority</code> is assigned, ensuring these pieces are written first so subsequent meshes can reference them.</p>
        </figcaption>
</figure>

<figure class="small"><img src="/images/tp-link-64-deluxe-source-2.png"
         alt="image"/><figcaption>
            <p>Control triangles and their materials are used to tell the software what pieces to fill in.</p>
        </figcaption>
</figure>

<figure class="small"><img src="/images/tp-link-64-deluxe-source-3.png"
         alt="image"/><figcaption>
            <p>Nesting is supported, so the Goron Tunic is able to cleverly reuse the Kokiri Tunic hat.</p>
        </figcaption>
</figure>
</p>
<h2 id="proxies-skeletal">Proxies (skeletal)</h2>
<p>Skeletal proxies provide an easy and convenient way to update every bone in a skeleton through code.
<figure class="small"><img src="/images/tp-link-64-deluxe-source-4.png"
         alt="image"/><figcaption>
            <p>When <code>PROXY</code> is enabled on a rigged mesh, it is neatly configured to use a proxy table.</p>
        </figcaption>
</figure>

<code>z64convert</code> writes these as code for you&hellip;</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="k">static</span> <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">proxy_Kokiri</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x0601FFA8</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x06020358</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x0601CE20</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x0601D068</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x060207D8</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x0601D430</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x0601D678</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x06020AC8</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x06020CC0</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x06020D70</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x06020FB8</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x0601EBF0</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x0601F098</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x06021298</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x0601F4C8</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x0601F908</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x06021378</span><span class="p">,</span>
	<span class="mh">0xDE010000</span><span class="p">,</span> <span class="mh">0x06021E60</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">proxy_Goron</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* etc */</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">proxy_Zora</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* etc */</span>
<span class="p">};</span>
</code></pre></div><p>&hellip; which you can then use in your embedded overlay like so:</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* override riggedmesh with one of the available tunics */</span>
<span class="k">if</span> <span class="p">(</span><span class="n">curTunic</span> <span class="o">!=</span> <span class="n">prevTunic</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">proxySize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">proxy_Kokiri</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">proxy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">overwrite</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">zh_seg2ram</span><span class="p">(</span><span class="n">PROXY_RIGGEDMESH</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">curTunic</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">case</span> <span class="nl">TUNIC_KOKIRI</span><span class="p">:</span>
			<span class="n">proxy</span> <span class="o">=</span> <span class="n">proxy_Kokiri</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="nl">TUNIC_GORON</span><span class="p">:</span>
			<span class="n">proxy</span> <span class="o">=</span> <span class="n">proxy_Goron</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="nl">TUNIC_ZORA</span><span class="p">:</span>
			<span class="n">proxy</span> <span class="o">=</span> <span class="n">proxy_Zora</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">z_bcopy</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">,</span> <span class="n">proxySize</span><span class="p">);</span>
	<span class="n">prevTunic</span> <span class="o">=</span> <span class="n">curTunic</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="proxies-generic">Proxies (generic)</h2>
<p>If you select the <strong>Master Sword handle</strong> in Blender and look at its settings in the <strong>Object Data</strong> tab, you&rsquo;ll see that it has the proxy setting enabled. This is so all references to it can easily be redirected to any model we want.</p>
<p>Why? Because normally, the game uses the Master Sword model when you hold the Kokiri Sword as Adult Link (the Ordon Sword in this mod). It is also displayed in Link&rsquo;s sheath when the Biggoron Sword is equipped (lazy Nintendo). This behavior is unacceptable, but is easily solvable now.</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cm">/* override Master Sword and Sheath models */</span>
<span class="k">if</span> <span class="p">(</span><span class="n">curSword</span> <span class="o">!=</span> <span class="n">prevSword</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">curSword</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">case</span> <span class="nl">SWORD_KOKIRI</span><span class="p">:</span>
			<span class="n">QVLO</span><span class="p">(</span><span class="n">DL_HILT_2_PROXY</span><span class="p">)</span> <span class="o">=</span> <span class="n">DL_HILT_1</span><span class="p">;</span>
			<span class="n">QVLO</span><span class="p">(</span><span class="n">DL_BLADE_2_PROXY</span><span class="p">)</span> <span class="o">=</span> <span class="n">DL_BLADE_1</span><span class="p">;</span>
			<span class="n">QVLO</span><span class="p">(</span><span class="n">DL_SHEATH_PROXY</span><span class="p">)</span> <span class="o">=</span> <span class="n">DL_SHEATH_KOKIRI</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="nl">SWORD_MASTER</span><span class="p">:</span>
			<span class="n">QVLO</span><span class="p">(</span><span class="n">DL_HILT_2_PROXY</span><span class="p">)</span> <span class="o">=</span> <span class="n">DL_HILT_2</span><span class="p">;</span>
			<span class="n">QVLO</span><span class="p">(</span><span class="n">DL_BLADE_2_PROXY</span><span class="p">)</span> <span class="o">=</span> <span class="n">DL_BLADE_2</span><span class="p">;</span>
			<span class="n">QVLO</span><span class="p">(</span><span class="n">DL_SHEATH_PROXY</span><span class="p">)</span> <span class="o">=</span> <span class="n">DL_SHEATH</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="nl">SWORD_GORON</span><span class="p">:</span>
			<span class="n">QVLO</span><span class="p">(</span><span class="n">DL_HILT_2_PROXY</span><span class="p">)</span> <span class="o">=</span> <span class="n">DL_HILT_3</span><span class="p">;</span>
			<span class="n">QVLO</span><span class="p">(</span><span class="n">DL_SHEATH_PROXY</span><span class="p">)</span> <span class="o">=</span> <span class="n">DL_SHEATH_BIGGORON</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">prevSword</span> <span class="o">=</span> <span class="n">curSword</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="disappearing-arm-brace">Disappearing arm brace</h2>
<p>We thought it would be cool if Link&rsquo;s arm brace disappeared when he acquired the Silver/Golden Gauntlets in our mod. I accomplished this in the cheapest way possible: the material assigned to his arm brace is given a <strong>negative priority</strong> so the associated geometry is at the end of the display list. Then, when Link has acquired the upgraded gauntlets, my code steps through the display list, finds the first reference to the arm brace material, and makes the display list end there instead. Voila: no more arm brace!
<figure><img src="/images/tp-link-64-deluxe-source-7.jpg"
         alt="image"/><figcaption>
            <p>Having the gauntlet appear on only one arm was a stylistic choice.</p>
        </figcaption>
</figure>
</p>
<h2 id="underwater-zora-tunic-mask">Underwater Zora Tunic Mask</h2>
<p>This was another fun Twilight Princess feature to recreate. When Link is submerged in water and wearing the Zora Tunic, a mask appears over his mouth and nose. This was accomplished kind of like the arm brace: my code steps through his <strong>head</strong> display list, finds the end, and then appends a pointer to the mask. When it is time to remove the mask, it disables this pointer.
<figure><img src="/images/tp-link-64-deluxe-source-5.jpg"
         alt="image"/><figcaption>
            <p>I would have never slept if I didn&rsquo;t add this.</p>
        </figcaption>
</figure>
</p>
<h2 id="boomerang">Boomerang</h2>
<p>Adult Link has unused Boomerang pointers in Ocarina of Time. These were reenabled so he can use the Gale Boomerang just like in Twilight Princess.</p>
<h2 id="the-end">The end</h2>
<p>It required some clever optimizations, but miraculously, I got the final result to fit in the same space as Link&rsquo;s original model file, even with all the extra equipment.</p>
<p>How much space was left over? I don&rsquo;t know, maybe a hundred bytes&hellip; definitely less than a kilobyte.</p>
<figure><img src="/images/tp-link-64-deluxe-source-6.jpg"
         alt="image"/><figcaption>
            <p>This happened to me once in real life.</p>
        </figcaption>
</figure></div>
        <div class="post-footer">
            <div class="info">
                
                <span class="separator"><a class="tag" href="/tags/fun/">fun</a><a class="tag" href="/tags/articles/">articles</a><a class="tag" href="/tags/mods/">mods</a></span>
            </div>
        </div>

        
    </div>


            </div>
        </div>
    </main>
</div><footer class="footer footer--base">        
    <div class="by_farbox">
        <ul class="footer__list">
            <li class="footer__item">&copy;
                
                    2018 - 2021
                
            </li>
            
            <li class="footer__item">
                <a href="https://old.z64.me/"  target="_blank" rel="noopener noreferrer"  title="">
                    old site
                </a>
            </li>
            
            <li class="footer__item">
                <a href="/post/index.xml"  title="">
                    rss
                </a>
            </li>
            
        </ul>
    </div>
</footer>

<script type="text/javascript"
        src="/js/medium-zoom.min.83cb1dd5fea8d42d87d1e601a07faa73089ad0ef9ccfe5daf6041289ebcc4e46.js"
        integrity="sha256-g8sd1f6o1C2H0eYBoH&#43;qcwia0O&#43;cz&#43;Xa9gQSievMTkY="
        crossorigin="anonymous"></script></body>

</html>
